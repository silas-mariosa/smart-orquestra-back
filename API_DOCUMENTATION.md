# Documenta칞칚o da API - Smart Orquestra Backend

## Vis칚o Geral

Esta API gerencia um sistema de orquestra inteligente, permitindo o controle de usu치rios, instrumentos, louvores, grupos e categorias. Todas as rotas requerem autentica칞칚o via JWT token no header `Authorization: Bearer <token>`.

**Base URL:** `http://localhost:4000` (ou porta configurada via vari치vel de ambiente PORT)

---

## 游댏 Autentica칞칚o (`/auth`)

### POST `/auth/signup`

**Descri칞칚o:** Registra um novo administrador e cria uma nova orquestra.

**Body:**

```json
{
  "nameOrquestra": "string",
  "name": "string",
  "email": "string",
  "senha": "string"
}
```

**Resposta de Sucesso:**

```json
{
  "success": true
}
```

**Resposta de Erro:**

```json
{
  "error": "E-mail ou senha n칚o conferem!"
}
```

---

### POST `/auth/signupUsers`

**Descri칞칚o:** Registra um novo membro em uma orquestra existente (requer token de administrador).

**Headers:** `Authorization: Bearer <token>`

**Body:**

```json
{
  "name": "string",
  "email": "string",
  "senha": "string"
}
```

**Resposta de Sucesso:**

```json
{
  "success": true
}
```

---

### POST `/auth/signin`

**Descri칞칚o:** Realiza login do usu치rio e retorna token JWT.

**Body:**

```json
{
  "email": "string",
  "senha": "string"
}
```

**Resposta de Sucesso:**

```json
{
  "token": "jwt_token_here"
}
```

**Cookie:** `authTokenSmart` ser치 definido automaticamente.

---

## 游논 Usu치rios (`/usuario`)

### GET `/usuario/`

**Descri칞칚o:** Lista todos os usu치rios da orquestra.

**Headers:** `Authorization: Bearer <token>`

**Resposta de Sucesso:**

```json
[
  {
    "id": "string",
    "name": "string",
    "accessLevel": "Administrador" | "Membro",
    "orchestraId": "string",
    "createdAt": "date"
  }
]
```

---

### GET `/usuario/:id`

**Descri칞칚o:** Obt칠m dados de um usu치rio espec칤fico.

**Headers:** `Authorization: Bearer <token>`

**Par칙metros:** `id` - ID do usu치rio

**Resposta de Sucesso:**

```json
{
  "id": "string",
  "name": "string",
  "accessLevel": "string",
  "orchestraId": "string"
}
```

---

### POST `/usuario/`

**Descri칞칚o:** Cria um novo usu치rio na orquestra.

**Headers:** `Authorization: Bearer <token>`

**Body:**

```json
{
  "auth_id": "string",
  "orchestraId": "string",
  "accessLevel": "Administrador" | "Membro",
  "name": "string",
  "instrumentListId": "string",
  "groupId": "string"
}
```

---

### PUT `/usuario/update-usuario`

**Descri칞칚o:** Atualiza dados pessoais do usu치rio logado.

**Headers:** `Authorization: Bearer <token>`

**Body:**

```json
{
  "name": "string",
  "brithday": "string",
  "whatsapp": "string",
  "cep": "string",
  "estado": "string",
  "cidade": "string",
  "bairro": "string",
  "endereco": "string",
  "numero": "string",
  "complemento": "string"
}
```

---

### POST `/usuario/create-with-password`

**Descri칞칚o:** Cria um novo usu치rio com senha aleat칩ria gerada automaticamente.

**Headers:** `Authorization: Bearer <token>`

**Permiss칚o:** Apenas usu치rios com n칤vel "Administrador"

**Body:**

```json
{
  "name": "string",
  "email": "string",
  "accessLevel": "Administrador" | "Membro"
}
```

**Resposta de Sucesso:**

```json
{
  "message": "Usu치rio criado com sucesso",
  "user": {
    "id": "string",
    "name": "string",
    "accessLevel": "string",
    "orchestraId": "string",
    "createdAt": "date"
  },
  "password": "senha_gerada_aleatoriamente"
}
```

**Resposta de Erro (Acesso Negado):**

```json
{
  "error": "Acesso negado. Apenas administradores podem criar usu치rios."
}
```

---

### POST `/usuario/:id/reset-password`

**Descri칞칚o:** Gera uma nova senha aleat칩ria para um usu치rio espec칤fico.

**Headers:** `Authorization: Bearer <token>`

**Permiss칚o:** Apenas usu치rios com n칤vel "Administrador"

**Par칙metros:** `id` - ID do usu치rio

**Resposta de Sucesso:**

```json
{
  "message": "Senha redefinida com sucesso",
  "user": {
    "id": "string",
    "name": "string",
    "accessLevel": "string",
    "orchestraId": "string"
  },
  "newPassword": "nova_senha_gerada_aleatoriamente"
}
```

**Resposta de Erro (Acesso Negado):**

```json
{
  "error": "Acesso negado. Apenas administradores podem redefinir senhas."
}
```

---

## 游꿧 Louvores (`/louvores`)

### GET `/louvores/`

**Descri칞칚o:** Lista todos os louvores da orquestra com informa칞칫es dos instrumentos.

**Headers:** `Authorization: Bearer <token>`

**Resposta de Sucesso:**

```json
[
  {
    "id": "string",
    "nameLouvor": "string",
    "description": "string",
    "pdf": "string",
    "mp3": "string",
    "instrumentos": "string",
    "instrumentoName": "string",
    "instrumentoCategories": "string",
    "instrumentoTipo": "string",
    "orchestraId": "string"
  }
]
```

---

### GET `/louvores/:id`

**Descri칞칚o:** Obt칠m um louvor espec칤fico por ID.

**Headers:** `Authorization: Bearer <token>`

**Par칙metros:** `id` - ID do louvor

---

### POST `/louvores/`

**Descri칞칚o:** Cria um novo louvor.

**Headers:** `Authorization: Bearer <token>`

**Body:**

```json
{
  "nameLouvor": "string",
  "description": "string",
  "pdf": "string",
  "mp3": "string",
  "instrumentos": "string"
}
```

---

### PUT `/louvores/:id`

**Descri칞칚o:** Atualiza um louvor existente.

**Headers:** `Authorization: Bearer <token>`

**Par칙metros:** `id` - ID do louvor

**Body:**

```json
{
  "nameLouvor": "string",
  "description": "string",
  "pdf": "string",
  "mp3": "string",
  "instrumentos": "string"
}
```

---

### DELETE `/louvores/:id`

**Descri칞칚o:** Remove um louvor.

**Headers:** `Authorization: Bearer <token>`

**Par칙metros:** `id` - ID do louvor

---

## 游꿮 Instrumentos (`/instrumentos`)

### GET `/instrumentos/`

**Descri칞칚o:** Lista todos os instrumentos da orquestra.

**Headers:** `Authorization: Bearer <token>`

**Resposta de Sucesso:**

```json
[
  {
    "id": "string",
    "nameInstrument": "string",
    "typeInstrument": "string",
    "categories": "string",
    "description": "string",
    "orchestraId": "string"
  }
]
```

---

### GET `/instrumentos/:id`

**Descri칞칚o:** Obt칠m um instrumento espec칤fico por ID.

**Headers:** `Authorization: Bearer <token>`

**Par칙metros:** `id` - ID do instrumento

---

### POST `/instrumentos/`

**Descri칞칚o:** Cria um novo instrumento.

**Headers:** `Authorization: Bearer <token>`

**Body:**

```json
{
  "nameInstrument": "string",
  "typeInstrument": "string",
  "categories": "string",
  "description": "string"
}
```

---

### PUT `/instrumentos/:id`

**Descri칞칚o:** Atualiza um instrumento existente.

**Headers:** `Authorization: Bearer <token>`

**Par칙metros:** `id` - ID do instrumento

**Body:**

```json
{
  "nameInstrument": "string",
  "typeInstrument": "string",
  "categories": "string",
  "description": "string"
}
```

---

### GET `/instrumentos/category/:id`

**Descri칞칚o:** Lista instrumentos por categoria.

**Headers:** `Authorization: Bearer <token>`

**Par칙metros:** `id` - ID da categoria

---

### DELETE `/instrumentos/:id`

**Descri칞칚o:** Remove um instrumento.

**Headers:** `Authorization: Bearer <token>`

**Par칙metros:** `id` - ID do instrumento

---

## 游늭 Categorias (`/categorias`)

### GET `/categorias/`

**Descri칞칚o:** Lista todas as categorias da orquestra.

**Headers:** `Authorization: Bearer <token>`

**Resposta de Sucesso:**

```json
[
  {
    "id": "string",
    "name": "string",
    "orchestraId": "string"
  }
]
```

---

### GET `/categorias/:id`

**Descri칞칚o:** Obt칠m uma categoria espec칤fica por ID.

**Headers:** `Authorization: Bearer <token>`

**Par칙metros:** `id` - ID da categoria

---

### POST `/categorias/`

**Descri칞칚o:** Cria uma nova categoria.

**Headers:** `Authorization: Bearer <token>`

**Body:**

```json
{
  "name": "string"
}
```

---

### PUT `/categorias/:id`

**Descri칞칚o:** Atualiza uma categoria existente.

**Headers:** `Authorization: Bearer <token>`

**Par칙metros:** `id` - ID da categoria

**Body:**

```json
{
  "name": "string"
}
```

---

### DELETE `/categorias/:id`

**Descri칞칚o:** Remove uma categoria.

**Headers:** `Authorization: Bearer <token>`

**Par칙metros:** `id` - ID da categoria

---

## 游논 Grupos (`/grupos`)

### GET `/grupos/`

**Descri칞칚o:** Lista todos os grupos da orquestra.

**Headers:** `Authorization: Bearer <token>`

**Resposta de Sucesso:**

```json
[
  {
    "id": "string",
    "name": "string",
    "historia": "string",
    "orchestraId": "string"
  }
]
```

---

### GET `/grupos/:id`

**Descri칞칚o:** Obt칠m um grupo espec칤fico por ID.

**Headers:** `Authorization: Bearer <token>`

**Par칙metros:** `id` - ID do grupo

---

### POST `/grupos/`

**Descri칞칚o:** Cria um novo grupo.

**Headers:** `Authorization: Bearer <token>`

**Body:**

```json
{
  "name": "string",
  "historia": "string"
}
```

---

### PUT `/grupos/:id`

**Descri칞칚o:** Atualiza um grupo existente.

**Headers:** `Authorization: Bearer <token>`

**Par칙metros:** `id` - ID do grupo

**Body:**

```json
{
  "name": "string",
  "historia": "string"
}
```

---

### DELETE `/grupos/:id`

**Descri칞칚o:** Remove um grupo.

**Headers:** `Authorization: Bearer <token>`

**Par칙metros:** `id` - ID do grupo

---

## 游늶 Lista de Grupos (`/grupo-lista`)

### GET `/grupo-lista/`

**Descri칞칚o:** Lista todas as associa칞칫es de usu치rios com grupos.

**Headers:** `Authorization: Bearer <token>`

**Resposta de Sucesso:**

```json
[
  {
    "id": "string",
    "GroupId": "string",
    "userId": "string",
    "orchestraId": "string"
  }
]
```

---

### GET `/grupo-lista/:id`

**Descri칞칚o:** Obt칠m uma associa칞칚o espec칤fica por ID.

**Headers:** `Authorization: Bearer <token>`

**Par칙metros:** `id` - ID da associa칞칚o

---

### POST `/grupo-lista/`

**Descri칞칚o:** Adiciona um usu치rio a um grupo.

**Headers:** `Authorization: Bearer <token>`

**Body:**

```json
{
  "GroupId": "string"
}
```

---

### PUT `/grupo-lista/:id`

**Descri칞칚o:** Atualiza a associa칞칚o de um usu치rio com grupo.

**Headers:** `Authorization: Bearer <token>`

**Par칙metros:** `id` - ID da associa칞칚o

**Body:**

```json
{
  "GroupId": "string"
}
```

---

### DELETE `/grupo-lista/:id`

**Descri칞칚o:** Remove um usu치rio de um grupo.

**Headers:** `Authorization: Bearer <token>`

**Par칙metros:** `id` - ID da associa칞칚o

---

## 游꿪 Lista de Instrumentos (`/instrumentos-lista`)

### GET `/instrumentos-lista/`

**Descri칞칚o:** Lista todos os instrumentos pessoais dos usu치rios.

**Headers:** `Authorization: Bearer <token>`

**Resposta de Sucesso:**

```json
[
  {
    "id": "string",
    "instrumentId": "string",
    "user_id": "string",
    "owner": "string",
    "position": "string",
    "serie": "string",
    "brand": "string",
    "model": "string",
    "orchestraId": "string"
  }
]
```

---

### GET `/instrumentos-lista/:id`

**Descri칞칚o:** Obt칠m um instrumento pessoal espec칤fico por ID.

**Headers:** `Authorization: Bearer <token>`

**Par칙metros:** `id` - ID do instrumento pessoal

---

### GET `/instrumentos-lista/by-user`

**Descri칞칚o:** Lista instrumentos pessoais do usu치rio logado.

**Headers:** `Authorization: Bearer <token>`

---

### POST `/instrumentos-lista/`

**Descri칞칚o:** Adiciona um instrumento pessoal ao usu치rio.

**Headers:** `Authorization: Bearer <token>`

**Body:**

```json
{
  "instrumentId": "string",
  "owner": "string",
  "position": "string",
  "serie": "string",
  "brand": "string",
  "model": "string"
}
```

---

### PUT `/instrumentos-lista/:id`

**Descri칞칚o:** Atualiza um instrumento pessoal.

**Headers:** `Authorization: Bearer <token>`

**Par칙metros:** `id` - ID do instrumento pessoal

**Body:**

```json
{
  "instrumentId": "string",
  "owner": "string",
  "position": "string",
  "serie": "string",
  "brand": "string",
  "model": "string"
}
```

---

### DELETE `/instrumentos-lista/:id`

**Descri칞칚o:** Remove um instrumento pessoal.

**Headers:** `Authorization: Bearer <token>`

**Par칙metros:** `id` - ID do instrumento pessoal

---

## 游늵 Dashboard (`/dashboard`)

### GET `/dashboard/membros`

**Descri칞칚o:** Retorna dados para o dashboard de membros com os 10 칰ltimos louvores cadastrados.

**Headers:** `Authorization: Bearer <token>`

**Resposta de Sucesso:**

```json
{
  "ultimosLouvores": [
    {
      "id": "string",
      "nameLouvor": "string",
      "description": "string",
      "pdf": "string",
      "mp3": "string",
      "instrumentos": "string",
      "orchestraId": "string",
      "createdAt": "date"
    }
  ],
  "totalLouvores": 10
}
```

---

### GET `/dashboard/admin`

**Descri칞칚o:** Retorna dados para o dashboard administrativo com estat칤sticas e listas dos 칰ltimos registros.

**Headers:** `Authorization: Bearer <token>`

**Permiss칚o:** Apenas usu치rios com n칤vel "Administrador"

**Resposta de Sucesso:**

```json
{
  "estatisticas": {
    "totalUsuarios": 25,
    "totalLouvores": 150,
    "usuariosPorNivel": {
      "Administrador": 2,
      "Membro": 23
    }
  },
  "ultimosUsuarios": [
    {
      "id": "string",
      "name": "string",
      "accessLevel": "string",
      "orchestraId": "string",
      "createdAt": "date"
    }
  ],
  "ultimosLouvores": [
    {
      "id": "string",
      "nameLouvor": "string",
      "description": "string",
      "pdf": "string",
      "mp3": "string",
      "instrumentos": "string",
      "orchestraId": "string",
      "createdAt": "date"
    }
  ]
}
```

**Resposta de Erro (Acesso Negado):**

```json
{
  "error": "Acesso negado. Apenas administradores podem acessar este dashboard."
}
```

---

## 游댢 Configura칞칚o e Execu칞칚o

### Vari치veis de Ambiente

```env
PORT=4000
DATABASE_URL=postgresql://user:password@localhost:5432/database
JWT_SECRET=your_jwt_secret_here
```

### Instala칞칚o e Execu칞칚o

```bash
# Instalar depend칡ncias
bun install

# Executar em modo desenvolvimento
bun dev

# Executar migra칞칫es
bun run migrate

# Gerar schema
bun run generate
```

### Swagger UI

Acesse `http://localhost:4000/swagger` para visualizar a documenta칞칚o interativa da API.

---

## 游닇 Notas Importantes

1. **Autentica칞칚o:** Todas as rotas (exceto `/auth/signup` e `/auth/signin`) requerem token JWT v치lido.
2. **OrchestraId:** A maioria das opera칞칫es 칠 filtrada pelo `orchestraId` do usu치rio logado.
3. **Permiss칫es:** Usu치rios com n칤vel "Administrador" t칡m acesso total, "Membros" t칡m acesso limitado.
4. **Valida칞칚o:** Todos os dados de entrada s칚o validados usando Zod.
5. **CORS:** A API est치 configurada para aceitar requisi칞칫es de diferentes origens.

---

## 游뚿 C칩digos de Erro Comuns

- `400` - Dados inv치lidos ou token inv치lido
- `404` - Recurso n칚o encontrado
- `500` - Erro interno do servidor

---

_Documenta칞칚o gerada automaticamente - Smart Orquestra Backend_
